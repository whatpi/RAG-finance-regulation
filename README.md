<img width="2365" height="890" alt="kb 금융 Write Retrieve 로직 drawio" src="https://github.com/user-attachments/assets/d5e80f25-859c-4ff0-9be7-56895c0a85be" />

---

# 금융 규제 알림을 위한 다단계 RAG 시스템

## 1. 프로젝트 개요

* **목표**: 금융 규제가 갱신되었을 때, 기업 내부 문서(사업 보고서, 프로젝트 문서, 약관 등) 중 수정이 필요한 부분을 자동으로 감지하고 알림 메시지를 생성하는 시스템을 구축
* **기대 효과**: 법무팀의 수동 검토 작업을 최소화하여 검토 속도 향상 및 비용 절감


## 2. 파이프라인 구조

### 2.1 색인

1. 문서를 문단 단위(`\n\n`)로 분할 → 여러 조각(fragment) 생성
2. 인접한 조각 N개를 하나의 \*\*번들(bundle)\*\*로 묶음
3. 각 번들마다 LLM을 통해 **요약(summary)** 생성
4. 생성된 요약을 **ChromaDB 임베딩 모델**로 벡터화 후 **벡터 DB**에 저장

### 2.2 검색

1. LLM을 활용해 특정 금융 규제에 영향을 받을만한 \*\*가상의 문서(HyDE 방식)\*\*를 생성

   * 결과는 정해진 JSON 규격을 따름
2. 가상의 문서 벡터값을 기반으로 FAISS에서 요약문서 검색
3. 검색된 \*\*요약문서(키)\*\*에 연결된 원본 조각들(Value)을 후보로 확보
4. 각 후보에 대해 **크롤링 데이터와의 연관성을 묻는 프롬프트**를 추가 생성
5. \*\*리랭킹 모델(Qwen3-Reranker-0.6B)\*\*로 상위 10%만 추출

### 2.3 생성

1. 최종 검색된 문서 조각들과 요약문서, 메타정보를 \*\*맥락(Context)\*\*으로 결합
2. 알림 메시지를 생성하는 **프롬프트** 작성
3. LLM이 **최종 알림 메시지**를 생성
4. 이 과정을 ChromaDB \*\*콜렉션 단위(batch)\*\*로 실행

## 3. 한계와 개선 방향

### 3.1 단일 실패 지점 (Single Point of Failure)

* **문제**: 요약문서(Key) 검색에 실패하면, 해당 키에 연결된 다수의 조각(Value)들이 모두 검색 대상에서 제외됨
* **해결책**: 문서를 크게 하나로 보고, **다양한 버전의 요약문서**를 동시에 키로 두어 **many-to-one** 구조로 개선 필요

### 3.2 랭킹 모델의 부적합성

* **문제**: 규제 검사는 특정 부분만 확인하는 것이 아니라 **문서 전체를 전수 조사**해야 함
* **한계**: 리랭킹 모델이 단순히 \*\*상위 10%\*\*만 추출하는 방식은 부적절하며, 키워드 일치보다는 **추론 능력**이 필요한 작업임
* **개선 방향**: 랭킹보다는 **전수 검사 기반의 필터링 로직**을 설계하거나, **추론형 LLM 분류기**를 활용한 검증 방식이 필요
